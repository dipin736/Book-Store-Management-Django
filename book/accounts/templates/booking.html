{% extends 'user_home.html' %}

{% load static %}
{%load crispy_forms_tags %} 


{% block main %}
 
<div class="container">
    <form action="{% url 'booking' %}" method="post" class="card p-3"  style="width: 100%;">
    <div class="row m-3">
        <div class="col-md-7 bg">
            <h3>Basic Details</h3>

                {% csrf_token %}
                <div class="m-3">
                    {{ form|crispy }}
                </div>
        </div>
        <div class="col-md-5">
            <h2 class=" bg-light text-center">CHECKOUT</h2>
               
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Book</th>
                        <th>Qty</th>
                        <th>Price</th>
                        <!-- <th>Total Cost</th> -->
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart_items %}
                        <tr>
                            <td>{{ item.book.title }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.total_cost  }}</td>
                            <!-- <td>{{ item.total_cost }}</td> -->
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="4">Your cart is empty</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="d-flex justify-content-between">
                <h6>Grand Total</h6>
                <h6 class="text-end font-weight-bold ">Rs {{ total_cost|floatformat:2 }}</h6>
            </div>
            
            <button type="submit" class="btn btn-block btn-warning w-100">
                Place Order
                <!-- <form action="success" method="POST">
                    <script
                        src="https://checkout.razorpay.com/v1/checkout.js"
                        data-key="rzp_test_tIYSGqIfPmDOgX" // Enter the Test API Key ID generated from Dashboard → Settings → API Keys
                        data-amount={{data.price}} // Amount is in currency subunits. Hence, 29935 refers to 29935 paise or ₹299.35.
                        data-currency="INR"// You can accept international payments by changing the currency code. Contact our Support Team to enable International for your account
                        data-order_id="order_CgmcjRh9ti2lP7"// Replace with the order_id generated by you in the backend.
                        data-buttontext="Pay with Razorpay"
                        data-name="Acme Corp"
                        data-description="A Wild Sheep Chase is the third novel by Japanese author Haruki Murakami"
                        data-image="https://example.com/your_logo.jpg"
                        data-prefill.name="{{ request.user.first_name }} {{ request.user.last_name }}"
                        data-prefill.email="{{ request.user.email }}"
                        data-theme.color="#F37254"
                    ></script>
                    <input type="hidden" custom="Hidden Element" name="hidden"/>
                    </form> -->
            </button>

        </div>
    </div>
    </form>

</div>
    
    <script>
          function grandTotal(){
               $.ajax({
                   url:"{% url 'get_cart_data' %}",
                   type:'get',
                   success:function(data){
                    //    $("#item_total").html(data.price)
                        $("#items").html(data.items);
                        $("#grand_total").html(data.price)
                   }
               })
           }
           grandTotal(); 
    </script>
  
 
{% endblock main %}
    
